#!/bin/sh

PROJECT=`basename $0`

arg()
{
	test "$1" = "-c" && CONFIG="remove"
	test "$1" = "-t" && TYPE="template"
	return 0
}

usage()
{
	echo "usage: $PROJECT [-t] name" >&2
	exit 1
}

JAILS="/usr/local/jails"
TYPE="container"
CONFIG="keep"

while echo -n "$1" | grep '^-' >/dev/null; do
	arg $1
	shift
done

NAME=$1
test "$NAME" != "" || usage

CONTAINER=$JAILS/"$TYPE"s/$NAME
if test -e $CONTAINER; then
	service jail onestop $NAME >/dev/null 2>&1
	jail -r $NAME >/dev/null 2>&1
	umount $CONTAINER/dev >/dev/null 2>&1
	chflags -R 0 $CONTAINER/
	rm -rf $CONTAINER/
fi

test "$CONFIG" = "remove" && rm -f /etc/jail.conf.d/$NAME.conf
